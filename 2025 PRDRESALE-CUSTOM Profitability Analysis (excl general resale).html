<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRDRESALE True Profitability Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }
        
        .dashboard {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 2.5em;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .alert {
            background: #d1ecf1;
            border-left: 5px solid #0c5460;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
        }
        
        .alert-title {
            font-weight: 700;
            color: #0c5460;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .kpi-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
        }
        
        .kpi-card.positive {
            border-left: 5px solid #28a745;
        }
        
        .kpi-card.negative {
            border-left: 5px solid #dc3545;
        }
        
        .kpi-card.neutral {
            border-left: 5px solid #667eea;
        }
        
        .kpi-label {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .kpi-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .kpi-value.positive {
            color: #28a745;
        }
        
        .kpi-value.negative {
            color: #dc3545;
        }
        
        .kpi-subtext {
            font-size: 0.85em;
            color: #888;
            margin-top: 8px;
        }
        
        .comparison-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .comparison-card {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .comparison-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .comparison-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .comparison-arrow {
            font-size: 2.5em;
            margin: 0 20px;
            color: #28a745;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .chart-card.full-width {
            grid-column: 1 / -1;
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .chart-container.tall {
            height: 500px;
        }
        
        .insights {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .insight-item {
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        
        .insight-item.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        
        .insight-item.success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .insight-item.danger {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .positive-text {
            color: #28a745;
            font-weight: 600;
        }
        
        .negative-text {
            color: #dc3545;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üîç PRDRESALE True Profitability Analysis</h1>
            <p class="subtitle">
                Comprehensive analysis matching PRDRESALE transactions with their original PRD purchase orders 
                to reveal true combined profitability. PRDRESALE items are "extra" tickets from profitable 
                original orders, and this analysis shows the complete picture.
            </p>
            <div class="alert">
                <div class="alert-title">‚úÖ Key Finding</div>
                When matched with original PRD purchases, the combined profitability is <strong>$48,715.63</strong> 
                with a <strong>10.93% margin</strong>. The PRDRESALE loss of -$50K is offset by the original 
                PRD profit of $97K from the same purchase orders.
            </div>
        </div>
        
        <!-- KPI Cards -->
        <div class="kpi-container">
            <div class="kpi-card positive">
                <div class="kpi-label">Original PRD Profit</div>
                <div class="kpi-value positive" id="prdProfit">$0</div>
                <div class="kpi-subtext" id="prdCount">0 PO groups</div>
            </div>
            <div class="kpi-card negative">
                <div class="kpi-label">PRDRESALE Profit/Loss</div>
                <div class="kpi-value negative" id="prdresaleProfit">$0</div>
                <div class="kpi-subtext" id="prdresaleCount">0 transactions</div>
            </div>
            <div class="kpi-card positive">
                <div class="kpi-label">Combined True Profit</div>
                <div class="kpi-value positive" id="combinedProfit">$0</div>
                <div class="kpi-subtext" id="combinedMargin">0% margin</div>
            </div>
            <div class="kpi-card neutral">
                <div class="kpi-label">Success Rate</div>
                <div class="kpi-value" id="successRate">0%</div>
                <div class="kpi-subtext" id="profitableCount">0 remain profitable</div>
            </div>
        </div>
        
        <!-- Comparison Section -->
        <div class="comparison-section">
            <h2 class="section-title">üìä Before & After Comparison</h2>
            <div class="comparison-grid">
                <div class="comparison-card">
                    <div class="comparison-label">ISOLATED VIEW</div>
                    <div class="comparison-value negative" id="isolatedView">-$50K</div>
                    <div style="margin-top: 10px; color: #666;">PRDRESALE appears as pure loss</div>
                </div>
                <div style="display: flex; align-items: center; justify-content: center;">
                    <div class="comparison-arrow">‚Üí</div>
                </div>
                <div class="comparison-card">
                    <div class="comparison-label">TRUE COMBINED VIEW</div>
                    <div class="comparison-value positive" id="trueView">+$49K</div>
                    <div style="margin-top: 10px; color: #666;">Matched with original PRD</div>
                </div>
            </div>
        </div>
        
        <!-- Charts -->
        <div class="chart-grid">
            <div class="chart-card">
                <h3 class="chart-title">üí∞ Profit Waterfall Analysis</h3>
                <div class="chart-container">
                    <canvas id="waterfallChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <h3 class="chart-title">üìà Combined Profit Distribution</h3>
                <div class="chart-container">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card full-width">
                <h3 class="chart-title">üèÜ Top 20 Most Profitable PO Groups (Combined)</h3>
                <div class="chart-container tall">
                    <canvas id="topPerformersChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card full-width">
                <h3 class="chart-title">‚ö†Ô∏è PO Groups That Turned Unprofitable After Resale</h3>
                <div class="chart-container">
                    <canvas id="turnedNegativeChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Insights -->
        <div class="insights">
            <h2 class="section-title">üí° Key Insights & Recommendations</h2>
            <div id="insightsContainer"></div>
        </div>
        
        <!-- Top Performers Table -->
        <div class="comparison-section">
            <h2 class="section-title">üéØ Top 10 Combined Profit PO Groups</h2>
            <div class="table-container">
                <table id="topTable"></table>
            </div>
        </div>
        
        <!-- Problem Cases Table -->
        <div class="comparison-section">
            <h2 class="section-title">‚ö†Ô∏è Cases That Turned Unprofitable</h2>
            <div class="table-container">
                <table id="problemTable"></table>
            </div>
        </div>
    </div>

    <script>
        // Load data
        const data = {"summary": {"total_po_groups": 979, "prd_profit": 97111.07999999999, "prdresale_profit": -48395.45, "combined_profit": 48715.63, "combined_margin": 10.934800811088435, "profitable_count": 925, "unprofitable_count": 54, "turned_negative_count": 34, "avg_prd_profit": 99.19415730337077, "avg_prdresale_profit": -49.433554647599586, "avg_combined_profit": 49.760602655771194}, "top_performers": [{"PO #": "111725-26806", "Event": "Texas Longhorns Football vs. Texas A&M Aggies Football", "Venue": "Darrell K Royal - Memorial Stadium", "PRD Count": 1, "PRD Profit": 1763.46, "PRD Revenue": 7709.46, "PRDRESALE Count": 1, "PRDRESALE Profit": -198.54, "PRDRESALE Revenue": 1783.46, "Combined Profit": 1564.92, "Combined Revenue": 9492.92, "Total Transactions": 2, "Combined Margin %": 16.485127863713167}, {"PO #": "112925-27914", "Event": "Michigan Wolverines Football vs. Ohio State Football", "Venue": "Michigan Stadium", "PRD Count": 1, "PRD Profit": 923.97, "PRD Revenue": 1766.18, "PRDRESALE Count": 1, "PRDRESALE Profit": -421.12, "PRDRESALE Revenue": 421.09, "Combined Profit": 502.85, "Combined Revenue": 2187.27, "Total Transactions": 2, "Combined Margin %": 22.989845789500155}, {"PO #": "112325-27405", "Event": "Auburn Tigers Football vs. Alabama Crimson Tide Football", "Venue": "Jordan Hare Stadium", "PRD Count": 1, "PRD Profit": 636.9, "PRD Revenue": 3347.64, "PRDRESALE Count": 1, "PRDRESALE Profit": -225.89, "PRDRESALE Revenue": 225.9, "Combined Profit": 411.01, "Combined Revenue": 3573.54, "Total Transactions": 2, "Combined Margin %": 11.50148032483196}, {"PO #": "112825-27890", "Event": "Cleveland Browns vs. Pittsburgh Steelers", "Venue": "Huntington Bank Field", "PRD Count": 1, "PRD Profit": 534.71, "PRD Revenue": 1057.72, "PRDRESALE Count": 1, "PRDRESALE Profit": -126.88, "PRDRESALE Revenue": 396.14, "Combined Profit": 407.83, "Combined Revenue": 1453.86, "Total Transactions": 2, "Combined Margin %": 28.05153178435338}, {"PO #": "110425-25820", "Event": "Los Angeles Lakers vs. San Antonio Spurs", "Venue": "Crypto.com Arena", "PRD Count": 1, "PRD Profit": 502.49, "PRD Revenue": 1004.96, "PRDRESALE Count": 1, "PRDRESALE Profit": -95.09, "PRDRESALE Revenue": 407.39, "Combined Profit": 407.4, "Combined Revenue": 1412.35, "Total Transactions": 2, "Combined Margin %": 28.84554111941091}, {"PO #": "122025-29368", "Event": "Los Angeles Lakers vs. Houston Rockets", "Venue": "Crypto.com Arena", "PRD Count": 1, "PRD Profit": 691.33, "PRD Revenue": 2592.54, "PRDRESALE Count": 1, "PRDRESALE Profit": -316.44, "PRDRESALE Revenue": 317.3, "Combined Profit": 374.89, "Combined Revenue": 2909.84, "Total Transactions": 2, "Combined Margin %": 12.883526241992689}, {"PO #": "112925-27980", "Event": "Bruno Mars w/ Bruno Mars", "Venue": "Dolby Live", "PRD Count": 1, "PRD Profit": 726.37, "PRD Revenue": 2848.08, "PRDRESALE Count": 1, "PRDRESALE Profit": -352.89, "PRDRESALE Revenue": 354.35, "Combined Profit": 373.48, "Combined Revenue": 3202.43, "Total Transactions": 2, "Combined Margin %": 11.662393869655231}, {"PO #": "120925-28603", "Event": "TCU Horned Frogs Mens Basketball vs. Arizona Wildcats Mens Basketball", "Venue": "Ed and Rae Schollmaier Arena", "PRD Count": 1, "PRD Profit": 485.4, "PRD Revenue": 1820.5, "PRDRESALE Count": 1, "PRDRESALE Profit": -117.02, "PRDRESALE Revenue": 150.0, "Combined Profit": 368.38, "Combined Revenue": 1970.5, "Total Transactions": 2, "Combined Margin %": 18.694747526008623}, {"PO #": "112925-27907", "Event": "Michigan Wolverines Football vs. Ohio State Football", "Venue": "Michigan Stadium", "PRD Count": 1, "PRD Profit": 541.77, "PRD Revenue": 2127.27, "PRDRESALE Count": 1, "PRDRESALE Profit": -188.3, "PRDRESALE Revenue": 340.2, "Combined Profit": 353.47, "Combined Revenue": 2467.47, "Total Transactions": 2, "Combined Margin %": 14.325199495839868}, {"PO #": "120725-28510", "Event": "Houston Texans vs. Las Vegas Raiders", "Venue": "NRG Stadium", "PRD Count": 1, "PRD Profit": 564.82, "PRD Revenue": 2130.54, "PRDRESALE Count": 1, "PRDRESALE Profit": -213.17, "PRDRESALE Revenue": 308.74, "Combined Profit": 351.6500000000001, "Combined Revenue": 2439.28, "Total Transactions": 2, "Combined Margin %": 14.41613918861304}, {"PO #": "110225-25653", "Event": "Mississippi State Bulldogs Football vs. Georgia Bulldogs Football", "Venue": "Davis Wade Stadium at Scott Field", "PRD Count": 1, "PRD Profit": 339.28, "PRD Revenue": 1110.28, "PRDRESALE Count": 1, "PRDRESALE Profit": 0.0, "PRDRESALE Revenue": 385.5, "Combined Profit": 339.28, "Combined Revenue": 1495.78, "Total Transactions": 2, "Combined Margin %": 22.682480043856717}, {"PO #": "110125-25580", "Event": "Texas Longhorns Football vs. Arkansas Razorbacks Football", "Venue": "Darrell K Royal - Memorial Stadium", "PRD Count": 1, "PRD Profit": 811.95, "PRD Revenue": 2859.15, "PRDRESALE Count": 1, "PRDRESALE Profit": -482.41, "PRDRESALE Revenue": 199.99, "Combined Profit": 329.54, "Combined Revenue": 3059.1400000000003, "Total Transactions": 2, "Combined Margin %": 10.772308557306957}, {"PO #": "111025-26424", "Event": "Orlando Magic vs. Portland Trail Blazers", "Venue": "Kia Center", "PRD Count": 1, "PRD Profit": 204.76, "PRD Revenue": 421.84, "PRDRESALE Count": 1, "PRDRESALE Profit": 123.02, "PRDRESALE Revenue": 340.1, "Combined Profit": 327.78, "Combined Revenue": 761.94, "Total Transactions": 2, "Combined Margin %": 43.01913536498937}, {"PO #": "121625-29065", "Event": "Indianapolis Colts vs. San Francisco 49ers", "Venue": "Lucas Oil Stadium", "PRD Count": 1, "PRD Profit": 588.94, "PRD Revenue": 2206.35, "PRDRESALE Count": 1, "PRDRESALE Profit": -269.34, "PRDRESALE Revenue": 269.8, "Combined Profit": 319.6000000000001, "Combined Revenue": 2476.15, "Total Transactions": 2, "Combined Margin %": 12.907134058922122}, {"PO #": "111125-26483", "Event": "Tulane Green Wave Football vs. Florida Atlantic Owls Football", "Venue": "Yulman Stadium", "PRD Count": 1, "PRD Profit": 364.83, "PRD Revenue": 1095.33, "PRDRESALE Count": 1, "PRDRESALE Profit": -53.49, "PRDRESALE Revenue": 190.01, "Combined Profit": 311.34, "Combined Revenue": 1285.34, "Total Transactions": 2, "Combined Margin %": 24.222384738668367}, {"PO #": "110425-25837", "Event": "Golden State Warriors vs. Sacramento Kings", "Venue": "Chase Center", "PRD Count": 1, "PRD Profit": 369.43, "PRD Revenue": 1453.14, "PRDRESALE Count": 1, "PRDRESALE Profit": -61.04, "PRDRESALE Revenue": 300.2, "Combined Profit": 308.39, "Combined Revenue": 1753.34, "Total Transactions": 2, "Combined Margin %": 17.588716392713334}, {"PO #": "110325-25776", "Event": "Alabama Crimson Tide Football vs. LSU Tigers Football", "Venue": "Saban Field at Bryant-Denny Stadium", "PRD Count": 1, "PRD Profit": 397.83, "PRD Revenue": 1720.08, "PRDRESALE Count": 1, "PRDRESALE Profit": -90.75, "PRDRESALE Revenue": 350.0, "Combined Profit": 307.08, "Combined Revenue": 2070.08, "Total Transactions": 2, "Combined Margin %": 14.834209305920542}, {"PO #": "121525-29022", "Event": "Toronto Raptors vs. Denver Nuggets", "Venue": "Scotiabank Arena", "PRD Count": 1, "PRD Profit": 385.14, "PRD Revenue": 1420.47, "PRDRESALE Count": 1, "PRDRESALE Profit": -78.2, "PRDRESALE Revenue": 266.91, "Combined Profit": 306.94, "Combined Revenue": 1687.38, "Total Transactions": 2, "Combined Margin %": 18.190330571655466}, {"PO #": "110125-25452", "Event": "Eagles", "Venue": "Sphere", "PRD Count": 1, "PRD Profit": 678.14, "PRD Revenue": 2029.44, "PRDRESALE Count": 1, "PRDRESALE Profit": -375.65, "PRDRESALE Revenue": 300.0, "Combined Profit": 302.49, "Combined Revenue": 2329.44, "Total Transactions": 2, "Combined Margin %": 12.985524417885845}, {"PO #": "110825-26205", "Event": "Boston Celtics vs. Brooklyn Nets", "Venue": "TD Garden", "PRD Count": 1, "PRD Profit": 466.27, "PRD Revenue": 1822.98, "PRDRESALE Count": 1, "PRDRESALE Profit": -166.29, "PRDRESALE Revenue": 285.95, "Combined Profit": 299.98, "Combined Revenue": 2108.93, "Total Transactions": 2, "Combined Margin %": 14.224274869246493}], "bottom_performers": [{"PO #": "121125-28779", "Event": "CM Newton Classic", "Venue": "Legacy Arena at The BJCC", "PRD Count": 1, "PRD Profit": -353.68, "PRD Revenue": 352.8, "PRDRESALE Count": 1, "PRDRESALE Profit": -144.08, "PRDRESALE Revenue": 562.4, "Combined Profit": -497.76, "Combined Revenue": 915.2, "Total Transactions": 2, "Combined Margin %": -54.38811188811189}, {"PO #": "122325-29513", "Event": "NCAA Division I FCS Football Championship", "Venue": "FirstBank Stadium", "PRD Count": 1, "PRD Profit": -111.45, "PRD Revenue": 217.8, "PRDRESALE Count": 1, "PRDRESALE Profit": -164.63, "PRDRESALE Revenue": 164.62, "Combined Profit": -276.08, "Combined Revenue": 382.42, "Total Transactions": 2, "Combined Margin %": -72.19287694158255}, {"PO #": "122325-29531", "Event": "New Jersey Devils vs. Washington Capitals", "Venue": "Prudential Center", "PRD Count": 1, "PRD Profit": -164.84, "PRD Revenue": 457.6, "PRDRESALE Count": 1, "PRDRESALE Profit": -109.49, "PRDRESALE Revenue": 46.12, "Combined Profit": -274.33, "Combined Revenue": 503.72, "Total Transactions": 2, "Combined Margin %": -54.46081156197887}, {"PO #": "123025-29747", "Event": "NHL Winter Classic vs. Florida Panthers", "Venue": "LoanDepot Park", "PRD Count": 1, "PRD Profit": -106.14, "PRD Revenue": 667.54, "PRDRESALE Count": 1, "PRDRESALE Profit": -120.83, "PRDRESALE Revenue": 266.01, "Combined Profit": -226.97, "Combined Revenue": 933.55, "Total Transactions": 2, "Combined Margin %": -24.31257029618124}, {"PO #": "111425-26634", "Event": "Tennessee Titans vs. Houston Texans", "Venue": "Nissan Stadium", "PRD Count": 1, "PRD Profit": -119.48, "PRD Revenue": 399.3, "PRDRESALE Count": 1, "PRDRESALE Profit": -60.12, "PRDRESALE Revenue": 104.5, "Combined Profit": -179.6, "Combined Revenue": 503.8, "Total Transactions": 2, "Combined Margin %": -35.649067090115125}, {"PO #": "122525-29625", "Event": "Tennessee Titans vs. New Orleans Saints", "Venue": "Nissan Stadium", "PRD Count": 1, "PRD Profit": -62.56, "PRD Revenue": 44.0, "PRDRESALE Count": 1, "PRDRESALE Profit": -53.78, "PRDRESALE Revenue": 52.78, "Combined Profit": -116.34, "Combined Revenue": 96.78, "Total Transactions": 2, "Combined Margin %": -120.21078735275884}, {"PO #": "112525-27599", "Event": "Texas Longhorns Football vs. Texas A&M Aggies Football", "Venue": "Darrell K Royal - Memorial Stadium", "PRD Count": 1, "PRD Profit": 1459.3, "PRD Revenue": 11109.05, "PRDRESALE Count": 1, "PRDRESALE Profit": -1569.96, "PRDRESALE Revenue": 359.99, "Combined Profit": -110.66000000000008, "Combined Revenue": 11469.04, "Total Transactions": 2, "Combined Margin %": -0.9648584362771434}, {"PO #": "122425-29563", "Event": "NCAA Division I FCS Football Championship", "Venue": "FirstBank Stadium", "PRD Count": 1, "PRD Profit": 13.52, "PRD Revenue": 232.1, "PRDRESALE Count": 1, "PRDRESALE Profit": -114.75, "PRDRESALE Revenue": 103.83, "Combined Profit": -101.23, "Combined Revenue": 335.93, "Total Transactions": 2, "Combined Margin %": -30.13425416009288}, {"PO #": "122625-29629", "Event": "Tennessee Titans vs. New Orleans Saints", "Venue": "Nissan Stadium", "PRD Count": 1, "PRD Profit": -48.09, "PRD Revenue": 44.0, "PRDRESALE Count": 1, "PRDRESALE Profit": -46.05, "PRDRESALE Revenue": 46.04, "Combined Profit": -94.14, "Combined Revenue": 90.03999999999999, "Total Transactions": 2, "Combined Margin %": -104.5535317636606}, {"PO #": "112225-27290", "Event": "Alabama Crimson Tide Football vs. Eastern Illinois Panthers Football", "Venue": "Saban Field at Bryant-Denny Stadium", "PRD Count": 1, "PRD Profit": -35.85, "PRD Revenue": 184.05, "PRDRESALE Count": 1, "PRDRESALE Profit": -45.65, "PRDRESALE Revenue": 27.65, "Combined Profit": -81.5, "Combined Revenue": 211.7, "Total Transactions": 2, "Combined Margin %": -38.497874350495984}, {"PO #": "112525-27549", "Event": "Baylor Bears Football vs. Houston Cougars Football", "Venue": "McLane Stadium", "PRD Count": 1, "PRD Profit": -53.67, "PRD Revenue": 63.21, "PRDRESALE Count": 1, "PRDRESALE Profit": -24.71, "PRDRESALE Revenue": 14.25, "Combined Profit": -78.38, "Combined Revenue": 77.46000000000001, "Total Transactions": 2, "Combined Margin %": -101.18770978569584}, {"PO #": "122125-29408", "Event": "New York Giants vs. Minnesota Vikings", "Venue": "MetLife Stadium", "PRD Count": 1, "PRD Profit": -38.73, "PRD Revenue": 29.75, "PRDRESALE Count": 1, "PRDRESALE Profit": -34.25, "PRDRESALE Revenue": 34.23, "Combined Profit": -72.97999999999999, "Combined Revenue": 63.98, "Total Transactions": 2, "Combined Margin %": -114.0668959049703}, {"PO #": "110225-25632", "Event": "Texas Tech Red Raiders Football vs. BYU Cougars Football", "Venue": "Jones AT&T Stadium", "PRD Count": 1, "PRD Profit": 98.66, "PRD Revenue": 614.59, "PRDRESALE Count": 1, "PRDRESALE Profit": -165.93, "PRDRESALE Revenue": 350.0, "Combined Profit": -67.27000000000001, "Combined Revenue": 964.59, "Total Transactions": 2, "Combined Margin %": -6.973947480276594}, {"PO #": "112525-27575", "Event": "Baltimore Ravens vs. Cincinnati Bengals", "Venue": "M&T Bank Stadium", "PRD Count": 1, "PRD Profit": -10.18, "PRD Revenue": 91.3, "PRDRESALE Count": 1, "PRDRESALE Profit": -50.74, "PRDRESALE Revenue": 50.74, "Combined Profit": -60.92, "Combined Revenue": 142.04, "Total Transactions": 2, "Combined Margin %": -42.88932695015489}, {"PO #": "121425-28929", "Event": "Nebraska Cornhuskers Mens Basketball", "Venue": "Pinnacle Bank Arena", "PRD Count": 1, "PRD Profit": -39.55, "PRD Revenue": 235.62, "PRDRESALE Count": 1, "PRDRESALE Profit": -19.66, "PRDRESALE Revenue": 19.65, "Combined Profit": -59.21, "Combined Revenue": 255.27, "Total Transactions": 2, "Combined Margin %": -23.195048380146503}, {"PO #": "112625-27726", "Event": "Colorado State University Rams Football vs. Air Force Academy Falcons Football", "Venue": "Canvas Stadium", "PRD Count": 1, "PRD Profit": -32.25, "PRD Revenue": 117.66, "PRDRESALE Count": 1, "PRDRESALE Profit": -24.99, "PRDRESALE Revenue": 24.98, "Combined Profit": -57.24, "Combined Revenue": 142.64, "Total Transactions": 2, "Combined Margin %": -40.12899607403253}, {"PO #": "112225-27326", "Event": "Penn State Nittany Lions Football vs. Nebraska Cornhuskers Football", "Venue": "Beaver Stadium", "PRD Count": 1, "PRD Profit": 1.63, "PRD Revenue": 186.84, "PRDRESALE Count": 1, "PRDRESALE Profit": -56.04, "PRDRESALE Revenue": 5.7, "Combined Profit": -54.41, "Combined Revenue": 192.54, "Total Transactions": 2, "Combined Margin %": -28.259063051833383}, {"PO #": "122125-29412", "Event": "Sacramento Kings vs. Houston Rockets", "Venue": "Golden 1 Center", "PRD Count": 1, "PRD Profit": -8.0, "PRD Revenue": 74.78, "PRDRESALE Count": 1, "PRDRESALE Profit": -40.98, "PRDRESALE Revenue": 41.8, "Combined Profit": -48.98, "Combined Revenue": 116.58, "Total Transactions": 2, "Combined Margin %": -42.014067593069136}, {"PO #": "112325-27414", "Event": "Golden State Warriors vs. Houston Rockets", "Venue": "Chase Center", "PRD Count": 1, "PRD Profit": 60.41, "PRD Revenue": 276.28, "PRDRESALE Count": 1, "PRDRESALE Profit": -107.58, "PRDRESALE Revenue": 108.3, "Combined Profit": -47.17, "Combined Revenue": 384.58, "Total Transactions": 2, "Combined Margin %": -12.26532841021374}, {"PO #": "112925-27917", "Event": "Louisville Cardinals Football vs. Kentucky Wildcats Football", "Venue": "L&N Federal Credit Union Stadium", "PRD Count": 1, "PRD Profit": 0.12, "PRD Revenue": 190.42, "PRDRESALE Count": 1, "PRDRESALE Profit": -46.7, "PRDRESALE Revenue": 48.45, "Combined Profit": -46.580000000000005, "Combined Revenue": 238.87, "Total Transactions": 2, "Combined Margin %": -19.500146523213463}], "turned_negative": [{"PO #": "112525-27599", "Event": "Texas Longhorns Football vs. Texas A&M Aggies Football", "Venue": "Darrell K Royal - Memorial Stadium", "PRD Count": 1, "PRD Profit": 1459.3, "PRD Revenue": 11109.05, "PRDRESALE Count": 1, "PRDRESALE Profit": -1569.96, "PRDRESALE Revenue": 359.99, "Combined Profit": -110.66000000000008, "Combined Revenue": 11469.04, "Total Transactions": 2, "Combined Margin %": -0.9648584362771434}, {"PO #": "122425-29563", "Event": "NCAA Division I FCS Football Championship", "Venue": "FirstBank Stadium", "PRD Count": 1, "PRD Profit": 13.52, "PRD Revenue": 232.1, "PRDRESALE Count": 1, "PRDRESALE Profit": -114.75, "PRDRESALE Revenue": 103.83, "Combined Profit": -101.23, "Combined Revenue": 335.93, "Total Transactions": 2, "Combined Margin %": -30.13425416009288}, {"PO #": "110225-25632", "Event": "Texas Tech Red Raiders Football vs. BYU Cougars Football", "Venue": "Jones AT&T Stadium", "PRD Count": 1, "PRD Profit": 98.66, "PRD Revenue": 614.59, "PRDRESALE Count": 1, "PRDRESALE Profit": -165.93, "PRDRESALE Revenue": 350.0, "Combined Profit": -67.27000000000001, "Combined Revenue": 964.59, "Total Transactions": 2, "Combined Margin %": -6.973947480276594}, {"PO #": "112225-27326", "Event": "Penn State Nittany Lions Football vs. Nebraska Cornhuskers Football", "Venue": "Beaver Stadium", "PRD Count": 1, "PRD Profit": 1.63, "PRD Revenue": 186.84, "PRDRESALE Count": 1, "PRDRESALE Profit": -56.04, "PRDRESALE Revenue": 5.7, "Combined Profit": -54.41, "Combined Revenue": 192.54, "Total Transactions": 2, "Combined Margin %": -28.259063051833383}, {"PO #": "112325-27414", "Event": "Golden State Warriors vs. Houston Rockets", "Venue": "Chase Center", "PRD Count": 1, "PRD Profit": 60.41, "PRD Revenue": 276.28, "PRDRESALE Count": 1, "PRDRESALE Profit": -107.58, "PRDRESALE Revenue": 108.3, "Combined Profit": -47.17, "Combined Revenue": 384.58, "Total Transactions": 2, "Combined Margin %": -12.26532841021374}, {"PO #": "112925-27917", "Event": "Louisville Cardinals Football vs. Kentucky Wildcats Football", "Venue": "L&N Federal Credit Union Stadium", "PRD Count": 1, "PRD Profit": 0.12, "PRD Revenue": 190.42, "PRDRESALE Count": 1, "PRDRESALE Profit": -46.7, "PRDRESALE Revenue": 48.45, "Combined Profit": -46.580000000000005, "Combined Revenue": 238.87, "Total Transactions": 2, "Combined Margin %": -19.500146523213463}, {"PO #": "111125-26465", "Event": "Illinois Fighting Illini Mens Basketball vs. Texas Tech Red Raiders Mens Basketball", "Venue": "State Farm Center", "PRD Count": 1, "PRD Profit": 0.88, "PRD Revenue": 213.24, "PRDRESALE Count": 1, "PRDRESALE Profit": -37.89, "PRDRESALE Revenue": 15.2, "Combined Profit": -37.01, "Combined Revenue": 228.44, "Total Transactions": 2, "Combined Margin %": -16.201190684643667}, {"PO #": "122825-29701", "Event": "Arkansas Razorbacks Mens Basketball", "Venue": "Bud Walton Arena", "PRD Count": 1, "PRD Profit": 7.01, "PRD Revenue": 178.02, "PRDRESALE Count": 1, "PRDRESALE Profit": -38.01, "PRDRESALE Revenue": 19.0, "Combined Profit": -31.0, "Combined Revenue": 197.02, "Total Transactions": 2, "Combined Margin %": -15.73444320373566}, {"PO #": "112125-27231", "Event": "Villanova Wildcats Mens Basketball vs. DePaul Blue Demons Mens Basketball", "Venue": "Finneran Pavilion", "PRD Count": 1, "PRD Profit": 6.17, "PRD Revenue": 57.2, "PRDRESALE Count": 1, "PRDRESALE Profit": -32.98, "PRDRESALE Revenue": 18.05, "Combined Profit": -26.809999999999995, "Combined Revenue": 75.25, "Total Transactions": 2, "Combined Margin %": -35.62790697674418}, {"PO #": "112425-27488", "Event": "Indiana Hoosiers Mens Basketball vs. Bethune-Cookman Wildcats Mens Basketball", "Venue": "Simon Skjodt Assembly Hall", "PRD Count": 1, "PRD Profit": 12.72, "PRD Revenue": 178.02, "PRDRESALE Count": 1, "PRDRESALE Profit": -37.05, "PRDRESALE Revenue": 18.05, "Combined Profit": -24.33, "Combined Revenue": 196.07, "Total Transactions": 2, "Combined Margin %": -12.40883357984393}, {"PO #": "121925-29338", "Event": "Alabama Crimson Tide Mens Basketball vs. Kentucky Wildcats Mens Basketball", "Venue": "Coleman Coliseum", "PRD Count": 1, "PRD Profit": 55.52, "PRD Revenue": 365.2, "PRDRESALE Count": 1, "PRDRESALE Profit": -77.42, "PRDRESALE Revenue": 77.42, "Combined Profit": -21.9, "Combined Revenue": 442.62, "Total Transactions": 2, "Combined Margin %": -4.947810763182865}, {"PO #": "111325-26590", "Event": "Miami Hurricanes Football vs. North Carolina State Wolfpack Football", "Venue": "Hard Rock Stadium", "PRD Count": 1, "PRD Profit": 12.88, "PRD Revenue": 218.26, "PRDRESALE Count": 1, "PRDRESALE Profit": -29.58, "PRDRESALE Revenue": 29.7, "Combined Profit": -16.699999999999996, "Combined Revenue": 247.96, "Total Transactions": 2, "Combined Margin %": -6.734957251169542}, {"PO #": "112225-27322", "Event": "Cincinnati Bearcats Football vs. BYU Cougars Football", "Venue": "Nippert Stadium", "PRD Count": 1, "PRD Profit": 10.83, "PRD Revenue": 66.03, "PRDRESALE Count": 1, "PRDRESALE Profit": -26.7, "PRDRESALE Revenue": 28.5, "Combined Profit": -15.87, "Combined Revenue": 94.53, "Total Transactions": 2, "Combined Margin %": -16.78832116788321}, {"PO #": "112225-27310", "Event": "South Carolina Gamecocks Football vs. Coastal Carolina Chanticleers Football", "Venue": "Williams-Brice Stadium", "PRD Count": 1, "PRD Profit": 8.49, "PRD Revenue": 52.96, "PRDRESALE Count": 1, "PRDRESALE Profit": -23.58, "PRDRESALE Revenue": 20.9, "Combined Profit": -15.089999999999998, "Combined Revenue": 73.86, "Total Transactions": 2, "Combined Margin %": -20.43054427294882}, {"PO #": "121325-28887", "Event": "Portland Winterhawks vs. Penticton Vees", "Venue": "Veterans Memorial Coliseum - OR", "PRD Count": 1, "PRD Profit": 1.8, "PRD Revenue": 73.1, "PRDRESALE Count": 1, "PRDRESALE Profit": -13.79, "PRDRESALE Revenue": 21.86, "Combined Profit": -11.989999999999998, "Combined Revenue": 94.96, "Total Transactions": 2, "Combined Margin %": -12.62636899747262}, {"PO #": "112625-27626", "Event": "Arkansas Razorbacks Football vs. Missouri Tigers Football", "Venue": "Donald W. Reynolds Razorback Stadium", "PRD Count": 1, "PRD Profit": 17.5, "PRD Revenue": 261.5, "PRDRESALE Count": 1, "PRDRESALE Profit": -29.0, "PRDRESALE Revenue": 19.8, "Combined Profit": -11.5, "Combined Revenue": 281.3, "Total Transactions": 2, "Combined Margin %": -4.088162104514752}, {"PO #": "111525-26661", "Event": "Virginia Cavaliers Mens Basketball vs. Marshall Thundering Herd Mens Basketball", "Venue": "John Paul Jones Arena", "PRD Count": 1, "PRD Profit": 10.72, "PRD Revenue": 38.22, "PRDRESALE Count": 1, "PRDRESALE Profit": -21.5, "PRDRESALE Revenue": 6.0, "Combined Profit": -10.78, "Combined Revenue": 44.22, "Total Transactions": 2, "Combined Margin %": -24.37810945273632}, {"PO #": "111825-26927", "Event": "San Diego State Aztecs Mens Basketball vs. Troy Trojans Mens Basketball", "Venue": "Viejas Arena", "PRD Count": 1, "PRD Profit": 2.74, "PRD Revenue": 20.21, "PRDRESALE Count": 1, "PRDRESALE Profit": -12.73, "PRDRESALE Revenue": 4.75, "Combined Profit": -9.99, "Combined Revenue": 24.96, "Total Transactions": 2, "Combined Margin %": -40.02403846153847}, {"PO #": "111925-26971", "Event": "Arizona Wildcats Football vs. Baylor Bears Football", "Venue": "Arizona Stadium", "PRD Count": 1, "PRD Profit": 29.7, "PRD Revenue": 208.2, "PRDRESALE Count": 1, "PRDRESALE Profit": -38.6, "PRDRESALE Revenue": 20.9, "Combined Profit": -8.900000000000002, "Combined Revenue": 229.1, "Total Transactions": 2, "Combined Margin %": -3.884766477520735}, {"PO #": "111925-26939", "Event": "Michigan Wolverines Mens Basketball vs. Middle Tennessee State Blue Raiders Mens Basketbal", "Venue": "Crisler Center", "PRD Count": 1, "PRD Profit": 12.05, "PRD Revenue": 34.2, "PRDRESALE Count": 1, "PRDRESALE Profit": -20.17, "PRDRESALE Revenue": 1.98, "Combined Profit": -8.120000000000001, "Combined Revenue": 36.18, "Total Transactions": 2, "Combined Margin %": -22.443338861249316}], "profit_distribution": [{"Bucket": "< -$100", "Count": 8, "Total Profit": -1782.97}, {"Bucket": "-$100 to -$50", "Count": 9, "Total Profit": -626.05}, {"Bucket": "-$50 to $0", "Count": 37, "Total Profit": -627.46}, {"Bucket": "$0 to $50", "Count": 611, "Total Profit": 12731.55}, {"Bucket": "$50 to $100", "Count": 180, "Total Profit": 12344.56}, {"Bucket": "$100 to $200", "Count": 89, "Total Profit": 12548.16}, {"Bucket": "$200 to $500", "Count": 43, "Total Profit": 12060.07}, {"Bucket": "> $500", "Count": 2, "Total Profit": 2067.77}]};
        
        // Format functions
        const formatCurrency = (val) => {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(val);
        };
        
        const formatNumber = (val) => {
            return new Intl.NumberFormat('en-US').format(val);
        };
        
        // Update KPIs
        const summary = data.summary;
        document.getElementById('prdProfit').textContent = formatCurrency(summary.prd_profit);
        document.getElementById('prdCount').textContent = formatNumber(summary.total_po_groups) + ' PO groups';
        document.getElementById('prdresaleProfit').textContent = formatCurrency(summary.prdresale_profit);
        document.getElementById('prdresaleCount').textContent = 'Avg: ' + formatCurrency(summary.avg_prdresale_profit) + '/PO';
        document.getElementById('combinedProfit').textContent = formatCurrency(summary.combined_profit);
        document.getElementById('combinedMargin').textContent = summary.combined_margin.toFixed(2) + '% margin';
        document.getElementById('successRate').textContent = ((summary.profitable_count / summary.total_po_groups) * 100).toFixed(1) + '%';
        document.getElementById('profitableCount').textContent = formatNumber(summary.profitable_count) + ' / ' + formatNumber(summary.total_po_groups);
        
        // Comparison values
        document.getElementById('isolatedView').textContent = formatCurrency(summary.prdresale_profit);
        document.getElementById('trueView').textContent = formatCurrency(summary.combined_profit);
        
        // Chart colors
        const colors = {
            primary: 'rgba(102, 126, 234, 0.8)',
            success: 'rgba(40, 167, 69, 0.8)',
            danger: 'rgba(220, 53, 69, 0.8)',
            warning: 'rgba(255, 193, 7, 0.8)',
            info: 'rgba(23, 162, 184, 0.8)'
        };
        
        // Waterfall Chart
        new Chart(document.getElementById('waterfallChart'), {
            type: 'bar',
            data: {
                labels: ['Original PRD\nProfit', 'PRDRESALE\nLoss', 'Net Combined\nProfit'],
                datasets: [{
                    label: 'Profit',
                    data: [summary.prd_profit, summary.prdresale_profit, summary.combined_profit],
                    backgroundColor: [colors.success, colors.danger, colors.primary]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => formatCurrency(context.parsed.y)
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            callback: (value) => formatCurrency(value)
                        }
                    }
                }
            }
        });
        
        // Distribution Chart
        new Chart(document.getElementById('distributionChart'), {
            type: 'bar',
            data: {
                labels: data.profit_distribution.map(d => d.Bucket),
                datasets: [{
                    label: 'PO Groups',
                    data: data.profit_distribution.map(d => d.Count),
                    backgroundColor: data.profit_distribution.map(d => 
                        d['Total Profit'] > 0 ? colors.success : colors.danger
                    )
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const dist = data.profit_distribution[context.dataIndex];
                                return [
                                    'Count: ' + formatNumber(dist.Count),
                                    'Total: ' + formatCurrency(dist['Total Profit'])
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Number of PO Groups' }
                    },
                    x: {
                        title: { display: true, text: 'Combined Profit Range' }
                    }
                }
            }
        });
        
        // Top Performers Chart
        new Chart(document.getElementById('topPerformersChart'), {
            type: 'bar',
            data: {
                labels: data.top_performers.map(p => p['PO #']),
                datasets: [
                    {
                        label: 'PRD Profit',
                        data: data.top_performers.map(p => p['PRD Profit']),
                        backgroundColor: colors.success
                    },
                    {
                        label: 'PRDRESALE Loss',
                        data: data.top_performers.map(p => p['PRDRESALE Profit']),
                        backgroundColor: colors.danger
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const perf = data.top_performers[context.dataIndex];
                                return [
                                    context.dataset.label + ': ' + formatCurrency(context.parsed.x),
                                    'Combined: ' + formatCurrency(perf['Combined Profit']),
                                    'Event: ' + perf.Event.substring(0, 50)
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        stacked: true,
                        ticks: {
                            callback: (value) => formatCurrency(value)
                        }
                    },
                    y: {
                        stacked: true
                    }
                }
            }
        });
        
        // Turned Negative Chart
        if (data.turned_negative.length > 0) {
            new Chart(document.getElementById('turnedNegativeChart'), {
                type: 'bar',
                data: {
                    labels: data.turned_negative.map(t => t['PO #']),
                    datasets: [
                        {
                            label: 'Started Profitable',
                            data: data.turned_negative.map(t => t['PRD Profit']),
                            backgroundColor: colors.success
                        },
                        {
                            label: 'Resale Loss',
                            data: data.turned_negative.map(t => t['PRDRESALE Profit']),
                            backgroundColor: colors.danger
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const t = data.turned_negative[context.dataIndex];
                                    return [
                                        context.dataset.label + ': ' + formatCurrency(context.parsed.y),
                                        'Combined: ' + formatCurrency(t['Combined Profit']),
                                        'Event: ' + t.Event.substring(0, 50)
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: (value) => formatCurrency(value)
                            }
                        }
                    }
                }
            });
        }
        
        // Generate insights
        const insights = [
            {
                type: 'success',
                text: `<strong>True Profitability:</strong> When properly matched, these PO groups generated ${formatCurrency(summary.combined_profit)} in combined profit with a ${summary.combined_margin.toFixed(2)}% margin - not the -$50K loss that appears in isolation.`
            },
            {
                type: 'success',
                text: `<strong>High Success Rate:</strong> ${((summary.profitable_count / summary.total_po_groups) * 100).toFixed(1)}% of PO groups (${formatNumber(summary.profitable_count)} out of ${formatNumber(summary.total_po_groups)}) remained profitable even after PRDRESALE losses.`
            },
            {
                type: 'warning',
                text: `<strong>Resale Impact:</strong> On average, resales reduce profit by ${formatCurrency(summary.avg_prdresale_profit)} per PO, but original orders average ${formatCurrency(summary.avg_prd_profit)} profit, resulting in net ${formatCurrency(summary.avg_combined_profit)} per PO group.`
            },
            {
                type: 'danger',
                text: `<strong>Problem Cases:</strong> ${summary.turned_negative_count} PO groups that were initially profitable turned unprofitable after resale. These represent the highest priority for pricing optimization.`
            },
            {
                type: 'info',
                text: `<strong>Recommendation:</strong> Continue PRDRESALE strategy but implement minimum pricing floors based on original cost to prevent profitable orders from turning negative. Focus on the ${summary.turned_negative_count} problem cases.`
            },
            {
                type: 'info',
                text: `<strong>Pricing Strategy:</strong> Set PRDRESALE prices at minimum 50% of original PRD ticket cost to maintain overall profitability and prevent erosion of initial gains.`
            }
        ];
        
        const insightsContainer = document.getElementById('insightsContainer');
        insights.forEach(insight => {
            const div = document.createElement('div');
            div.className = `insight-item ${insight.type}`;
            div.innerHTML = insight.text;
            insightsContainer.appendChild(div);
        });
        
        // Top Performers Table
        const topTable = document.getElementById('topTable');
        let topHtml = '<thead><tr><th>PO #</th><th>Event</th><th>PRD Profit</th><th>PRDRESALE</th><th>Combined</th><th>Margin %</th></tr></thead><tbody>';
        data.top_performers.slice(0, 10).forEach(p => {
            topHtml += `<tr>
                <td>${p['PO #']}</td>
                <td>${p.Event.substring(0, 50)}</td>
                <td class="positive-text">${formatCurrency(p['PRD Profit'])}</td>
                <td class="negative-text">${formatCurrency(p['PRDRESALE Profit'])}</td>
                <td class="positive-text"><strong>${formatCurrency(p['Combined Profit'])}</strong></td>
                <td>${p['Combined Margin %'].toFixed(1)}%</td>
            </tr>`;
        });
        topHtml += '</tbody>';
        topTable.innerHTML = topHtml;
        
        // Problem Cases Table
        const problemTable = document.getElementById('problemTable');
        if (data.turned_negative.length > 0) {
            let problemHtml = '<thead><tr><th>PO #</th><th>Event</th><th>Started With</th><th>Resale Loss</th><th>Ended With</th></tr></thead><tbody>';
            data.turned_negative.slice(0, 10).forEach(p => {
                problemHtml += `<tr>
                    <td>${p['PO #']}</td>
                    <td>${p.Event.substring(0, 50)}</td>
                    <td class="positive-text">${formatCurrency(p['PRD Profit'])}</td>
                    <td class="negative-text">${formatCurrency(p['PRDRESALE Profit'])}</td>
                    <td class="negative-text"><strong>${formatCurrency(p['Combined Profit'])}</strong></td>
                </tr>`;
            });
            problemHtml += '</tbody>';
            problemTable.innerHTML = problemHtml;
        } else {
            problemTable.innerHTML = '<p style="padding: 20px; text-align: center;">No cases turned unprofitable</p>';
        }
    </script>
</body>
</html>