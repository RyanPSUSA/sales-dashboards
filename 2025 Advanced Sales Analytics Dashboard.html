<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Sales Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
            min-height: 100vh;
        }
        
        .dashboard {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.8em;
            font-weight: 700;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.2em;
        }
        
        .nav-tabs {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 12px 24px;
            border: none;
            background: #f0f0f0;
            color: #333;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab-button:hover {
            background: #e0e0e0;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .kpi-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            transition: transform 0.3s;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
        }
        
        .kpi-label {
            font-size: 0.85em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .kpi-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }
        
        .kpi-subtext {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .chart-card.full-width {
            grid-column: 1 / -1;
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .chart-container.tall {
            height: 500px;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .insight-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .insight-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .insight-item {
            padding: 12px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            margin-bottom: 12px;
            border-radius: 5px;
            font-size: 0.95em;
        }
        
        .insight-item strong {
            color: #667eea;
        }
        
        .positive {
            color: #28a745;
            font-weight: 600;
        }
        
        .negative {
            color: #dc3545;
            font-weight: 600;
        }
        
        .warning {
            color: #ffc107;
            font-weight: 600;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üéØ Advanced Sales Analytics Dashboard</h1>
            <p class="subtitle">Comprehensive multi-dimensional analysis of sales performance, profitability, and market opportunities</p>
        </div>
        
        <div class="nav-tabs">
            <button class="tab-button active" onclick="showTab('overview')">üìä Overview</button>
            <button class="tab-button" onclick="showTab('profitability')">üí∞ Profitability Analysis</button>
            <button class="tab-button" onclick="showTab('pricing')">üíµ Price Bucket Analysis</button>
            <button class="tab-button" onclick="showTab('performance')">‚ö° Performance Metrics</button>
            <button class="tab-button" onclick="showTab('market')">üåç Market Analysis</button>
            <button class="tab-button" onclick="showTab('operational')">‚öôÔ∏è Operational Insights</button>
            <button class="tab-button" onclick="showTab('losses')">‚ö†Ô∏è Loss Analysis</button>
        </div>
        
        <!-- OVERVIEW TAB -->
        <div id="overview" class="tab-content active">
            <div class="kpi-container">
                <div class="kpi-card">
                    <div class="kpi-label">Avg Profit/Ticket</div>
                    <div class="kpi-value" id="avgProfitTicket">$0</div>
                    <div class="kpi-subtext">Median: <span id="medianProfitTicket">$0</span></div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Avg Markup %</div>
                    <div class="kpi-value" id="avgMarkup">0%</div>
                    <div class="kpi-subtext">Price optimization metric</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Avg Lead Time</div>
                    <div class="kpi-value" id="avgLeadTime">0</div>
                    <div class="kpi-subtext">Median: <span id="medianLeadTime">0</span> days</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Sales Velocity</div>
                    <div class="kpi-value" id="saleVelocity">0h</div>
                    <div class="kpi-subtext">PO to Sale time</div>
                </div>
            </div>
            
            <div class="insights-grid">
                <div class="insight-card">
                    <div class="insight-title">üí° Key Insights</div>
                    <div id="keyInsights"></div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">üéØ Opportunities</div>
                    <div id="opportunities"></div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">‚ö†Ô∏è Risk Areas</div>
                    <div id="riskAreas"></div>
                </div>
            </div>
        </div>
        
        <!-- PROFITABILITY TAB -->
        <div id="profitability" class="tab-content">
            <div class="chart-grid">
                <div class="chart-card full-width">
                    <h3 class="chart-title">üèÜ Top 20 Sections by Avg Profit Per Ticket</h3>
                    <div class="chart-container tall">
                        <canvas id="sectionChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üíµ Revenue Bucket Analysis</h3>
                    <div class="chart-container">
                        <canvas id="revenueBucketChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üìà Top Venues by Markup %</h3>
                    <div class="chart-container">
                        <canvas id="venueMarkupChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card full-width">
                    <h3 class="chart-title">üé´ Quantity Optimization Analysis</h3>
                    <div class="chart-container">
                        <canvas id="quantityOptChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PRICING TAB -->
        <div id="pricing" class="tab-content">
            <div class="chart-grid">
                <div class="chart-card full-width">
                    <h3 class="chart-title">üíµ Profit Margin by Price Per Ticket</h3>
                    <div class="chart-container">
                        <canvas id="priceBucketMarginChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üìä Transaction Volume by Price Bucket</h3>
                    <div class="chart-container">
                        <canvas id="priceBucketVolumeChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üí∞ Total Profit by Price Bucket</h3>
                    <div class="chart-container">
                        <canvas id="priceBucketProfitChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üéØ Avg Profit Per Transaction by Price</h3>
                    <div class="chart-container">
                        <canvas id="priceBucketAvgChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üé´ Avg Profit Per Ticket by Price</h3>
                    <div class="chart-container">
                        <canvas id="pricePerTicketChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="insights-grid">
                <div class="insight-card">
                    <div class="insight-title">üí° Price Bucket Insights</div>
                    <div id="priceBucketInsights"></div>
                </div>
            </div>
        </div>
        
        <!-- PERFORMANCE TAB -->
        <div id="performance" class="tab-content">
            <div class="chart-grid">
                <div class="chart-card">
                    <h3 class="chart-title">‚è∞ Lead Time Performance</h3>
                    <div class="chart-container">
                        <canvas id="leadTimeChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üìÖ Day of Week Analysis</h3>
                    <div class="chart-container">
                        <canvas id="dowChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card full-width">
                    <h3 class="chart-title">üïê Hour of Day Pattern</h3>
                    <div class="chart-container">
                        <canvas id="hourChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MARKET TAB -->
        <div id="market" class="tab-content">
            <div class="chart-grid">
                <div class="chart-card">
                    <h3 class="chart-title">üé≠ Event Category Breakdown</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üìä Category Profit Comparison</h3>
                    <div class="chart-container">
                        <canvas id="categoryBarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- OPERATIONAL TAB -->
        <div id="operational" class="tab-content">
            <div class="chart-grid">
                <div class="chart-card">
                    <h3 class="chart-title">üè∑Ô∏è Tag Performance</h3>
                    <div class="chart-container">
                        <canvas id="tagChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üì¶ Optimal Order Sizes</h3>
                    <div class="chart-container">
                        <canvas id="quantityProfitChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- LOSSES TAB -->
        <div id="losses" class="tab-content">
            <div class="chart-grid">
                <div class="chart-card">
                    <h3 class="chart-title">üèüÔ∏è Top 10 Loss-Making Venues</h3>
                    <div class="chart-container">
                        <canvas id="lossVenueChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üé≠ Top 10 Loss-Making Events</h3>
                    <div class="chart-container">
                        <canvas id="lossEventChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="insight-card">
                <div class="insight-title">üí° Loss Mitigation Strategies</div>
                <div id="lossMitigation"></div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Load data
        const enhancedData = {"sections": [{"Section": "CRT-J", "Profit Per Ticket": 802.09, "Revenue Per Ticket": 8621.53, "Profit": 8020.94, "PO #": 5}, {"Section": "CRT-G", "Profit Per Ticket": 706.38, "Revenue Per Ticket": 8709.57, "Profit": 8898.01, "PO #": 5}, {"Section": "VIP", "Profit Per Ticket": 222.99, "Revenue Per Ticket": 1791.63, "Profit": 8830.42, "PO #": 21}, {"Section": "FLR9", "Profit Per Ticket": 160.28, "Revenue Per Ticket": 1162.78, "Profit": 1709.57, "PO #": 5}, {"Section": "FLOOR3", "Profit Per Ticket": 150.94, "Revenue Per Ticket": 854.53, "Profit": 2394.94, "PO #": 8}, {"Section": "23AA", "Profit Per Ticket": 134.26, "Revenue Per Ticket": 913.12, "Profit": 1004.93, "PO #": 5}, {"Section": "CRTS", "Profit Per Ticket": 112.32, "Revenue Per Ticket": 1065.03, "Profit": 1797.14, "PO #": 8}, {"Section": "VIP12", "Profit Per Ticket": 111.12, "Revenue Per Ticket": 1342.64, "Profit": 1429.04, "PO #": 6}, {"Section": "FLR2", "Profit Per Ticket": 109.63, "Revenue Per Ticket": 780.59, "Profit": 3057.34, "PO #": 15}, {"Section": "FLR1", "Profit Per Ticket": 108.0, "Revenue Per Ticket": 674.97, "Profit": 1978.72, "PO #": 11}, {"Section": "CRT-L", "Profit Per Ticket": 95.1, "Revenue Per Ticket": 764.47, "Profit": 1344.9, "PO #": 6}, {"Section": "246", "Profit Per Ticket": 81.17, "Revenue Per Ticket": 642.5, "Profit": 1288.5, "PO #": 8}, {"Section": "LOGE13", "Profit Per Ticket": 78.98, "Revenue Per Ticket": 800.97, "Profit": 994.79, "PO #": 5}, {"Section": "SEC3", "Profit Per Ticket": 78.65, "Revenue Per Ticket": 519.78, "Profit": 1121.79, "PO #": 8}, {"Section": "FL1", "Profit Per Ticket": 77.47, "Revenue Per Ticket": 549.06, "Profit": 774.72, "PO #": 5}, {"Section": "LOGE1", "Profit Per Ticket": 74.18, "Revenue Per Ticket": 693.64, "Profit": 4865.52, "PO #": 26}, {"Section": "9", "Profit Per Ticket": 69.2, "Revenue Per Ticket": 372.33, "Profit": 5137.57, "PO #": 53}, {"Section": "30", "Profit Per Ticket": 69.11, "Revenue Per Ticket": 286.5, "Profit": 407.87, "PO #": 5}, {"Section": "130C", "Profit Per Ticket": 67.39, "Revenue Per Ticket": 721.87, "Profit": 1207.0, "PO #": 5}, {"Section": "FLR4", "Profit Per Ticket": 63.36, "Revenue Per Ticket": 529.53, "Profit": 1399.08, "PO #": 10}], "lead_time": [{"Bucket": "Same Day/Past", "Total Profit": 104154.13, "Avg Profit": 22.82, "Count": 4565}, {"Bucket": "1-7 days", "Total Profit": 398633.91, "Avg Profit": 44.73, "Count": 8912}, {"Bucket": "8-30 days", "Total Profit": 212210.12, "Avg Profit": 58.72, "Count": 3614}, {"Bucket": "31-90 days", "Total Profit": 118533.91, "Avg Profit": 65.63, "Count": 1806}, {"Bucket": "90+ days", "Total Profit": 59060.44, "Avg Profit": 103.43, "Count": 571}], "categories": [{"Event_Category": "Other", "Profit": 663849.19, "Total": 6321364.48, "PO #": 13291, "Quantity": 25424, "Avg Profit": 49.95, "Profit Margin %": 10.5}, {"Event_Category": "Sports", "Profit": 174545.86, "Total": 1711983.59, "PO #": 5399, "Quantity": 11458, "Avg Profit": 32.33, "Profit Margin %": 10.2}, {"Event_Category": "Bowl Game", "Profit": 24250.52, "Total": 206783.5, "PO #": 203, "Quantity": 485, "Avg Profit": 119.46, "Profit Margin %": 11.73}, {"Event_Category": "Music/Concert", "Profit": 18169.12, "Total": 143310.2, "PO #": 393, "Quantity": 806, "Avg Profit": 46.23, "Profit Margin %": 12.68}, {"Event_Category": "Theater/Arts", "Profit": 11777.82, "Total": 96111.85, "PO #": 182, "Quantity": 288, "Avg Profit": 64.71, "Profit Margin %": 12.25}], "day_of_week": [{"Day": "Monday", "Total Profit": 120969.91, "Avg Profit": 49.58, "Count": 2440}, {"Day": "Tuesday", "Total Profit": 142952.98, "Avg Profit": 52.83, "Count": 2706}, {"Day": "Wednesday", "Total Profit": 113289.2, "Avg Profit": 42.99, "Count": 2635}, {"Day": "Thursday", "Total Profit": 115071.3, "Avg Profit": 41.8, "Count": 2753}, {"Day": "Friday", "Total Profit": 150867.74, "Avg Profit": 44.98, "Count": 3354}, {"Day": "Saturday", "Total Profit": 130676.8, "Avg Profit": 39.22, "Count": 3332}, {"Day": "Sunday", "Total Profit": 118764.58, "Avg Profit": 52.83, "Count": 2248}], "hour_of_day": [{"Hour": 0, "Total Profit": 20716.86, "Avg Profit": 44.27, "Count": 468}, {"Hour": 1, "Total Profit": 13181.98, "Avg Profit": 41.72, "Count": 316}, {"Hour": 2, "Total Profit": 8654.38, "Avg Profit": 44.84, "Count": 193}, {"Hour": 3, "Total Profit": 5705.37, "Avg Profit": 46.77, "Count": 122}, {"Hour": 4, "Total Profit": 2117.26, "Avg Profit": 23.27, "Count": 91}, {"Hour": 5, "Total Profit": 3783.38, "Avg Profit": 47.29, "Count": 80}, {"Hour": 6, "Total Profit": 3282.26, "Avg Profit": 30.11, "Count": 109}, {"Hour": 7, "Total Profit": 11812.94, "Avg Profit": 57.62, "Count": 205}, {"Hour": 8, "Total Profit": 13983.11, "Avg Profit": 33.78, "Count": 414}, {"Hour": 9, "Total Profit": 21529.11, "Avg Profit": 33.74, "Count": 638}, {"Hour": 10, "Total Profit": 34210.26, "Avg Profit": 39.28, "Count": 871}, {"Hour": 11, "Total Profit": 41954.24, "Avg Profit": 38.7, "Count": 1084}, {"Hour": 12, "Total Profit": 62419.58, "Avg Profit": 46.62, "Count": 1339}, {"Hour": 13, "Total Profit": 64586.79, "Avg Profit": 46.8, "Count": 1380}, {"Hour": 14, "Total Profit": 84616.62, "Avg Profit": 61.58, "Count": 1374}, {"Hour": 15, "Total Profit": 74098.17, "Avg Profit": 53.93, "Count": 1374}, {"Hour": 16, "Total Profit": 55512.84, "Avg Profit": 43.37, "Count": 1280}, {"Hour": 17, "Total Profit": 52733.45, "Avg Profit": 43.73, "Count": 1206}, {"Hour": 18, "Total Profit": 50078.76, "Avg Profit": 40.58, "Count": 1234}, {"Hour": 19, "Total Profit": 54780.51, "Avg Profit": 44.83, "Count": 1222}, {"Hour": 20, "Total Profit": 54491.17, "Avg Profit": 44.23, "Count": 1232}, {"Hour": 21, "Total Profit": 65672.94, "Avg Profit": 53.26, "Count": 1233}, {"Hour": 22, "Total Profit": 58129.06, "Avg Profit": 48.85, "Count": 1190}, {"Hour": 23, "Total Profit": 34541.47, "Avg Profit": 42.49, "Count": 813}], "tags": [{"Tags": "PRD", "Profit": 943933.3, "PO #": 18347}, {"Tags": "TRANSFER", "Profit": -0.01, "PO #": 6}, {"Tags": "Expired,PRD", "Profit": -1335.82, "PO #": 19}, {"Tags": "PRDRESALE", "Profit": -50004.96, "PO #": 1096}], "loss_venues": [{"Venue": "Madison Square Garden", "Loss": -3142.52}, {"Venue": "Darrell K Royal - Memorial Stadium", "Loss": -2887.45}, {"Venue": "Globe Life Field", "Loss": -2821.02}, {"Venue": "TD Garden", "Loss": -2770.4}, {"Venue": "Arthur Ashe Stadium", "Loss": -2743.9399999999996}, {"Venue": "United Center", "Loss": -2652.03}, {"Venue": "Dean E Smith Center", "Loss": -2414.9700000000003}, {"Venue": "Saban Field at Bryant-Denny Stadium", "Loss": -1968.69}, {"Venue": "Pinnacle Bank Arena", "Loss": -1963.58}, {"Venue": "Hard Rock Stadium", "Loss": -1819.49}], "loss_events": [{"Event": "Chris Brown w/ Summer Walker", "Loss": -2929.6400000000003}, {"Event": "US Open Tennis", "Loss": -2743.9399999999996}, {"Event": "Tame Impala", "Loss": -2178.32}, {"Event": "Texas Longhorns Football vs. Texas A&M Aggies Football", "Loss": -2013.17}, {"Event": "Nebraska Cornhuskers Mens Basketball vs. Michigan State Spartans Mens Basketball", "Loss": -1522.6999999999998}, {"Event": "Tennessee Titans vs. New Orleans Saints", "Loss": -1423.14}, {"Event": "Boston Celtics vs. Detroit Pistons", "Loss": -1410.8799999999999}, {"Event": "Michigan Wolverines Football vs. Ohio State Football", "Loss": -1386.65}, {"Event": "Capital One Orange Bowl", "Loss": -1379.07}, {"Event": "NCAA Division I FCS Football Championship", "Loss": -1069.77}], "venue_markup": [{"Venue": "Moody Coliseum", "Markup %": 35.09, "Profit": 281.95, "PO #": 13}, {"Venue": "Memorial Stadium - Nebraska", "Markup %": 35.03, "Profit": 108.25, "PO #": 5}, {"Venue": "Haas Pavilion", "Markup %": 34.56, "Profit": 338.49, "PO #": 6}, {"Venue": "Brookshire Grocery Arena", "Markup %": 31.41, "Profit": 81.48, "PO #": 5}, {"Venue": "Doak Campbell Stadium", "Markup %": 29.98, "Profit": 150.44, "PO #": 10}, {"Venue": "Kenan Stadium", "Markup %": 27.27, "Profit": 241.82, "PO #": 12}, {"Venue": "Wamu Theater - Seattle", "Markup %": 26.13, "Profit": 1072.83, "PO #": 16}, {"Venue": "Walmart AMP", "Markup %": 24.93, "Profit": 260.39, "PO #": 10}, {"Venue": "Harrah's Cherokee Resort Event Center", "Markup %": 24.26, "Profit": 406.0, "PO #": 7}, {"Venue": "Paramount Theatre-Colorado", "Markup %": 23.87, "Profit": 286.15, "PO #": 8}, {"Venue": "U.S. Bank Stadium", "Markup %": 23.65, "Profit": 599.46, "PO #": 11}, {"Venue": "Cynthia Woods Mitchell Pavilion by Huntsman", "Markup %": 22.18, "Profit": 758.17, "PO #": 10}, {"Venue": "Mackey Arena", "Markup %": 22.12, "Profit": 4475.02, "PO #": 13}, {"Venue": "Alaska Airlines Arena at Hec Edmundson Pavilion", "Markup %": 22.01, "Profit": 476.59, "PO #": 15}, {"Venue": "Target Center", "Markup %": 21.37, "Profit": 1096.97, "PO #": 28}, {"Venue": "BMO Field", "Markup %": 21.35, "Profit": 847.79, "PO #": 28}, {"Venue": "State Theatre-MN", "Markup %": 21.24, "Profit": 805.36, "PO #": 9}, {"Venue": "First Horizon Coliseum", "Markup %": 21.01, "Profit": 655.74, "PO #": 12}, {"Venue": "Citizens House of Blues Boston", "Markup %": 20.62, "Profit": 57.5, "PO #": 7}, {"Venue": "Gampel Pavilion", "Markup %": 20.09, "Profit": 943.39, "PO #": 13}], "quantity_optimization": [{"Quantity": 7, "Total Profit": 17705.28, "Avg Profit": 334.06, "Avg Profit/Ticket": 47.72, "Count": 53}, {"Quantity": 10, "Total Profit": 939.2, "Avg Profit": 156.53, "Avg Profit/Ticket": 15.65, "Count": 6}, {"Quantity": 6, "Total Profit": 8448.3, "Avg Profit": 118.99, "Avg Profit/Ticket": 19.83, "Count": 71}, {"Quantity": 4, "Total Profit": 132090.99, "Avg Profit": 103.2, "Avg Profit/Ticket": 25.8, "Count": 1280}, {"Quantity": 5, "Total Profit": 24406.11, "Avg Profit": 102.98, "Avg Profit/Ticket": 20.6, "Count": 237}, {"Quantity": 3, "Total Profit": 128328.6, "Avg Profit": 84.21, "Avg Profit/Ticket": 28.07, "Count": 1524}, {"Quantity": 8, "Total Profit": 966.08, "Avg Profit": 74.31, "Avg Profit/Ticket": 9.29, "Count": 13}, {"Quantity": 2, "Total Profit": 557394.21, "Avg Profit": 54.18, "Avg Profit/Ticket": 27.09, "Count": 10288}, {"Quantity": 1, "Total Profit": 20985.68, "Avg Profit": 3.5, "Avg Profit/Ticket": 3.5, "Count": 5991}], "revenue_buckets": [{"Bucket": "$0-100", "Total Profit": -12277.84, "Avg Profit": -2.66, "Avg Profit/Ticket": -3.72, "Count": 4609}, {"Bucket": "$100-250", "Total Profit": 97840.93, "Avg Profit": 14.85, "Avg Profit/Ticket": 7.55, "Count": 6588}, {"Bucket": "$250-500", "Total Profit": 150795.06, "Avg Profit": 37.11, "Avg Profit/Ticket": 18.04, "Count": 4064}, {"Bucket": "$500-1K", "Total Profit": 191921.2, "Avg Profit": 80.23, "Avg Profit/Ticket": 38.44, "Count": 2392}, {"Bucket": "$1K+", "Total Profit": 478606.28, "Avg Profit": 272.71, "Avg Profit/Ticket": 113.99, "Count": 1755}], "summary_advanced": {"avg_profit_per_ticket": 19.757657660841883, "median_profit_per_ticket": 11.19, "avg_markup_pct": 10.033290860463898, "avg_lead_time_days": 11.03816904664064, "median_lead_time_days": 2.1013888888888888, "avg_sale_velocity_hours": 6.790629066502294, "total_losses": -118999.77, "loss_count": 2067}, "price_buckets": [{"Bucket": "Under $50", "Transactions": 3228, "Total Profit": 541.06, "Total Revenue": 207100.61, "Total Cost": 206555.05, "Profit Margin %": 0.2612546626492312, "Avg Profit": 0.17, "Avg Profit Per Ticket": -3.63, "Avg Price Per Ticket": 33.11, "Total Tickets": 5985}, {"Bucket": "$50-$100", "Transactions": 5446, "Total Profit": 68536.17, "Total Revenue": 778823.7, "Total Cost": 710288.09, "Profit Margin %": 8.799959477350267, "Avg Profit": 12.58, "Avg Profit Per Ticket": 4.75, "Avg Price Per Ticket": 73.32, "Total Tickets": 10608}, {"Bucket": "$100-$150", "Transactions": 3572, "Total Profit": 79465.63, "Total Revenue": 844300.68, "Total Cost": 764830.5, "Profit Margin %": 9.41200592187134, "Avg Profit": 22.25, "Avg Profit Per Ticket": 10.09, "Avg Price Per Ticket": 122.56, "Total Tickets": 6894}, {"Bucket": "$150-$200", "Transactions": 1794, "Total Profit": 63780.74, "Total Revenue": 636583.06, "Total Cost": 572802.59, "Profit Margin %": 10.019232996869253, "Avg Profit": 35.55, "Avg Profit Per Ticket": 15.49, "Avg Price Per Ticket": 172.65, "Total Tickets": 3685}, {"Bucket": "$200-$300", "Transactions": 2163, "Total Profit": 112260.57, "Total Revenue": 1079094.61, "Total Cost": 966834.36, "Profit Margin %": 10.403218490730854, "Avg Profit": 51.9, "Avg Profit Per Ticket": 22.69, "Avg Price Per Ticket": 243.2, "Total Tickets": 4439}, {"Bucket": "$300-$400", "Transactions": 1031, "Total Profit": 83123.95, "Total Revenue": 748003.16, "Total Cost": 664879.32, "Profit Margin %": 11.112780593065944, "Avg Profit": 80.62, "Avg Profit Per Ticket": 35.77, "Avg Price Per Ticket": 345.13, "Total Tickets": 2165}, {"Bucket": "$400-$500", "Transactions": 612, "Total Profit": 71804.47, "Total Revenue": 571281.41, "Total Cost": 499477.03, "Profit Margin %": 12.569019180932212, "Avg Profit": 117.33, "Avg Profit Per Ticket": 55.99, "Avg Price Per Ticket": 446.55, "Total Tickets": 1279}, {"Bucket": "$500-$750", "Transactions": 817, "Total Profit": 130311.61, "Total Revenue": 1058707.53, "Total Cost": 928395.98, "Profit Margin %": 12.308556074971905, "Avg Profit": 159.5, "Avg Profit Per Ticket": 74.26, "Avg Price Per Ticket": 601.8, "Total Tickets": 1759}, {"Bucket": "$750-$1,000", "Transactions": 291, "Total Profit": 65072.25, "Total Revenue": 526813.49, "Total Cost": 461741.26, "Profit Margin %": 12.352047021423084, "Avg Profit": 223.62, "Avg Profit Per Ticket": 108.54, "Avg Price Per Ticket": 858.78, "Total Tickets": 614}, {"Bucket": "Over $1,000", "Transactions": 454, "Total Profit": 231989.18, "Total Revenue": 2028845.37, "Total Cost": 1796856.23, "Profit Margin %": 11.434542199734029, "Avg Profit": 510.99, "Avg Profit Per Ticket": 236.85, "Avg Price Per Ticket": 2087.85, "Total Tickets": 960}]};
        
        // Format functions
        const formatCurrency = (val) => {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(val);
        };
        
        const formatNumber = (val) => {
            return new Intl.NumberFormat('en-US').format(val);
        };
        
        // Update KPIs
        const summary = enhancedData.summary_advanced;
        document.getElementById('avgProfitTicket').textContent = formatCurrency(summary.avg_profit_per_ticket);
        document.getElementById('medianProfitTicket').textContent = formatCurrency(summary.median_profit_per_ticket);
        document.getElementById('avgMarkup').textContent = summary.avg_markup_pct.toFixed(1) + '%';
        document.getElementById('avgLeadTime').textContent = summary.avg_lead_time_days.toFixed(1) + ' days';
        document.getElementById('medianLeadTime').textContent = summary.median_lead_time_days.toFixed(1);
        document.getElementById('saleVelocity').textContent = summary.avg_sale_velocity_hours.toFixed(1) + 'h';
        
        // Chart colors
        const colors = {
            primary: 'rgba(102, 126, 234, 0.8)',
            secondary: 'rgba(118, 75, 162, 0.8)',
            success: 'rgba(40, 167, 69, 0.8)',
            danger: 'rgba(220, 53, 69, 0.8)',
            warning: 'rgba(255, 193, 7, 0.8)',
            info: 'rgba(23, 162, 184, 0.8)',
            purple: 'rgba(156, 39, 176, 0.8)',
            orange: 'rgba(253, 126, 20, 0.8)'
        };
        
        // Generate color array
        const generateColors = (count) => {
            const baseColors = Object.values(colors);
            return Array(count).fill(0).map((_, i) => baseColors[i % baseColors.length]);
        };
        
        // PROFITABILITY CHARTS
        
        // Section Chart
        new Chart(document.getElementById('sectionChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.sections.map(s => s.Section),
                datasets: [{
                    label: 'Avg Profit Per Ticket',
                    data: enhancedData.sections.map(s => s['Profit Per Ticket']),
                    backgroundColor: colors.primary
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const section = enhancedData.sections[context.dataIndex];
                                return [
                                    'Avg Profit/Ticket: ' + formatCurrency(section['Profit Per Ticket']),
                                    'Total Profit: ' + formatCurrency(section.Profit),
                                    'Transactions: ' + section['PO #']
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            callback: (value) => '$' + value
                        }
                    }
                }
            }
        });
        
        // Revenue Bucket Chart
        new Chart(document.getElementById('revenueBucketChart'), {
            type: 'doughnut',
            data: {
                labels: enhancedData.revenue_buckets.map(r => r.Bucket),
                datasets: [{
                    data: enhancedData.revenue_buckets.map(r => r['Total Profit']),
                    backgroundColor: generateColors(enhancedData.revenue_buckets.length)
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const bucket = enhancedData.revenue_buckets[context.dataIndex];
                                return [
                                    bucket.Bucket,
                                    'Total: ' + formatCurrency(bucket['Total Profit']),
                                    'Avg: ' + formatCurrency(bucket['Avg Profit']),
                                    'Count: ' + formatNumber(bucket.Count)
                                ];
                            }
                        }
                    }
                }
            }
        });
        
        // Venue Markup Chart
        new Chart(document.getElementById('venueMarkupChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.venue_markup.slice(0, 10).map(v => v.Venue.substring(0, 25)),
                datasets: [{
                    label: 'Markup %',
                    data: enhancedData.venue_markup.slice(0, 10).map(v => v['Markup %']),
                    backgroundColor: colors.success
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        ticks: {
                            callback: (value) => value + '%'
                        }
                    }
                }
            }
        });
        
        // Quantity Optimization Chart
        new Chart(document.getElementById('quantityOptChart'), {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Order Sizes',
                    data: enhancedData.quantity_optimization.map(q => ({
                        x: q.Quantity,
                        y: q['Avg Profit'],
                        r: Math.sqrt(q.Count) * 2
                    })),
                    backgroundColor: colors.info
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const q = enhancedData.quantity_optimization[context.dataIndex];
                                return [
                                    q.Quantity + ' tickets',
                                    'Avg Profit: ' + formatCurrency(q['Avg Profit']),
                                    'Avg Per Ticket: ' + formatCurrency(q['Avg Profit/Ticket']),
                                    'Orders: ' + formatNumber(q.Count)
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Ticket Quantity' }
                    },
                    y: {
                        title: { display: true, text: 'Average Profit ($)' },
                        ticks: {
                            callback: (value) => '$' + value
                        }
                    }
                }
            }
        });
        
        // PERFORMANCE CHARTS
        
        // Lead Time Chart
        new Chart(document.getElementById('leadTimeChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.lead_time.map(l => l.Bucket),
                datasets: [{
                    label: 'Avg Profit',
                    data: enhancedData.lead_time.map(l => l['Avg Profit']),
                    backgroundColor: colors.warning
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const lead = enhancedData.lead_time[context.dataIndex];
                                return [
                                    'Avg Profit: ' + formatCurrency(lead['Avg Profit']),
                                    'Total: ' + formatCurrency(lead['Total Profit']),
                                    'Count: ' + formatNumber(lead.Count)
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            callback: (value) => '$' + value
                        }
                    }
                }
            }
        });
        
        // Day of Week Chart
        new Chart(document.getElementById('dowChart'), {
            type: 'line',
            data: {
                labels: enhancedData.day_of_week.map(d => d.Day.substring(0, 3)),
                datasets: [{
                    label: 'Total Profit',
                    data: enhancedData.day_of_week.map(d => d['Total Profit']),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const day = enhancedData.day_of_week[context.dataIndex];
                                return [
                                    'Total: ' + formatCurrency(day['Total Profit']),
                                    'Avg: ' + formatCurrency(day['Avg Profit']),
                                    'Count: ' + formatNumber(day.Count)
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            callback: (value) => '$' + (value/1000).toFixed(0) + 'K'
                        }
                    }
                }
            }
        });
        
        // Hour of Day Chart
        new Chart(document.getElementById('hourChart'), {
            type: 'line',
            data: {
                labels: enhancedData.hour_of_day.map(h => h.Hour + ':00'),
                datasets: [{
                    label: 'Total Profit',
                    data: enhancedData.hour_of_day.map(h => h['Total Profit']),
                    borderColor: colors.secondary,
                    backgroundColor: 'rgba(118, 75, 162, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const hour = enhancedData.hour_of_day[context.dataIndex];
                                return [
                                    'Total: ' + formatCurrency(hour['Total Profit']),
                                    'Avg: ' + formatCurrency(hour['Avg Profit']),
                                    'Count: ' + formatNumber(hour.Count)
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            callback: (value) => '$' + (value/1000).toFixed(0) + 'K'
                        }
                    }
                }
            }
        });
        
        // PRICING CHARTS
        
        // Price Bucket Margin Chart
        new Chart(document.getElementById('priceBucketMarginChart'), {
            type: 'line',
            data: {
                labels: enhancedData.price_buckets.map(p => p.Bucket),
                datasets: [{
                    label: 'Profit Margin %',
                    data: enhancedData.price_buckets.map(p => p['Profit Margin %']),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const bucket = enhancedData.price_buckets[context.dataIndex];
                                return [
                                    'Margin: ' + bucket['Profit Margin %'].toFixed(2) + '%',
                                    'Total Profit: ' + formatCurrency(bucket['Total Profit']),
                                    'Transactions: ' + formatNumber(bucket.Transactions),
                                    'Avg Price/Ticket: ' + formatCurrency(bucket['Avg Price Per Ticket'])
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Profit Margin %' },
                        ticks: {
                            callback: (value) => value.toFixed(1) + '%'
                        }
                    },
                    x: {
                        title: { display: true, text: 'Price Per Ticket Range' },
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
        
        // Price Bucket Volume Chart
        new Chart(document.getElementById('priceBucketVolumeChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.price_buckets.map(p => p.Bucket),
                datasets: [{
                    label: 'Transactions',
                    data: enhancedData.price_buckets.map(p => p.Transactions),
                    backgroundColor: colors.info
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const bucket = enhancedData.price_buckets[context.dataIndex];
                                return [
                                    'Transactions: ' + formatNumber(bucket.Transactions),
                                    'Total Tickets: ' + formatNumber(bucket['Total Tickets']),
                                    'Avg Price: ' + formatCurrency(bucket['Avg Price Per Ticket'])
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Number of Transactions' }
                    },
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
        
        // Price Bucket Total Profit Chart
        new Chart(document.getElementById('priceBucketProfitChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.price_buckets.map(p => p.Bucket),
                datasets: [{
                    label: 'Total Profit',
                    data: enhancedData.price_buckets.map(p => p['Total Profit']),
                    backgroundColor: enhancedData.price_buckets.map(p => 
                        p['Total Profit'] > 0 ? colors.success : colors.danger
                    )
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const bucket = enhancedData.price_buckets[context.dataIndex];
                                return [
                                    'Total Profit: ' + formatCurrency(bucket['Total Profit']),
                                    'Revenue: ' + formatCurrency(bucket['Total Revenue']),
                                    'Margin: ' + bucket['Profit Margin %'].toFixed(2) + '%'
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Total Profit ($)' },
                        ticks: {
                            callback: (value) => '$' + (value/1000).toFixed(0) + 'K'
                        }
                    },
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
        
        // Price Bucket Avg Profit Chart
        new Chart(document.getElementById('priceBucketAvgChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.price_buckets.map(p => p.Bucket),
                datasets: [{
                    label: 'Avg Profit/Transaction',
                    data: enhancedData.price_buckets.map(p => p['Avg Profit']),
                    backgroundColor: colors.warning
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const bucket = enhancedData.price_buckets[context.dataIndex];
                                return [
                                    'Avg Profit: ' + formatCurrency(bucket['Avg Profit']),
                                    'Transactions: ' + formatNumber(bucket.Transactions),
                                    'Margin: ' + bucket['Profit Margin %'].toFixed(2) + '%'
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Avg Profit per Transaction ($)' },
                        ticks: {
                            callback: (value) => '$' + value
                        }
                    },
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
        
        // Price Per Ticket Profit Chart
        new Chart(document.getElementById('pricePerTicketChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.price_buckets.map(p => p.Bucket),
                datasets: [{
                    label: 'Avg Profit/Ticket',
                    data: enhancedData.price_buckets.map(p => p['Avg Profit Per Ticket']),
                    backgroundColor: colors.secondary
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const bucket = enhancedData.price_buckets[context.dataIndex];
                                return [
                                    'Avg Profit/Ticket: ' + formatCurrency(bucket['Avg Profit Per Ticket']),
                                    'Avg Price/Ticket: ' + formatCurrency(bucket['Avg Price Per Ticket']),
                                    'Total Tickets: ' + formatNumber(bucket['Total Tickets'])
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Avg Profit per Ticket ($)' },
                        ticks: {
                            callback: (value) => '$' + value
                        }
                    },
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
        
        // MARKET CHARTS
        
        // Category Pie Chart
        new Chart(document.getElementById('categoryChart'), {
            type: 'pie',
            data: {
                labels: enhancedData.categories.map(c => c.Event_Category),
                datasets: [{
                    data: enhancedData.categories.map(c => c.Profit),
                    backgroundColor: generateColors(enhancedData.categories.length)
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const cat = enhancedData.categories[context.dataIndex];
                                return [
                                    cat.Event_Category,
                                    'Profit: ' + formatCurrency(cat.Profit),
                                    'Margin: ' + cat['Profit Margin %'].toFixed(1) + '%',
                                    'Count: ' + formatNumber(cat['PO #'])
                                ];
                            }
                        }
                    }
                }
            }
        });
        
        // Category Bar Chart
        new Chart(document.getElementById('categoryBarChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.categories.map(c => c.Event_Category),
                datasets: [{
                    label: 'Total Profit',
                    data: enhancedData.categories.map(c => c.Profit),
                    backgroundColor: colors.success
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        ticks: {
                            callback: (value) => '$' + (value/1000).toFixed(0) + 'K'
                        }
                    }
                }
            }
        });
        
        // OPERATIONAL CHARTS
        
        // Tag Chart
        new Chart(document.getElementById('tagChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.tags.map(t => t.Tags),
                datasets: [{
                    label: 'Profit',
                    data: enhancedData.tags.map(t => t.Profit),
                    backgroundColor: enhancedData.tags.map(t => 
                        t.Profit > 0 ? colors.success : colors.danger
                    )
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        ticks: {
                            callback: (value) => '$' + (value/1000).toFixed(0) + 'K'
                        }
                    }
                }
            }
        });
        
        // Quantity Profit Chart
        new Chart(document.getElementById('quantityProfitChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.quantity_optimization.map(q => q.Quantity + ' tickets'),
                datasets: [{
                    label: 'Avg Profit',
                    data: enhancedData.quantity_optimization.map(q => q['Avg Profit']),
                    backgroundColor: colors.primary
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const q = enhancedData.quantity_optimization[context.dataIndex];
                                return [
                                    'Avg Profit: ' + formatCurrency(q['Avg Profit']),
                                    'Per Ticket: ' + formatCurrency(q['Avg Profit/Ticket']),
                                    'Orders: ' + formatNumber(q.Count)
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            callback: (value) => '$' + value
                        }
                    }
                }
            }
        });
        
        // LOSS CHARTS
        
        // Loss Venue Chart
        new Chart(document.getElementById('lossVenueChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.loss_venues.map(v => v.Venue.substring(0, 30)),
                datasets: [{
                    label: 'Loss Amount',
                    data: enhancedData.loss_venues.map(v => Math.abs(v.Loss)),
                    backgroundColor: colors.danger
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                return 'Loss: ' + formatCurrency(Math.abs(context.parsed.x));
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            callback: (value) => '$' + value
                        }
                    }
                }
            }
        });
        
        // Loss Event Chart
        new Chart(document.getElementById('lossEventChart'), {
            type: 'bar',
            data: {
                labels: enhancedData.loss_events.map(e => e.Event.substring(0, 30)),
                datasets: [{
                    label: 'Loss Amount',
                    data: enhancedData.loss_events.map(e => Math.abs(e.Loss)),
                    backgroundColor: colors.danger
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                return 'Loss: ' + formatCurrency(Math.abs(context.parsed.x));
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            callback: (value) => '$' + value
                        }
                    }
                }
            }
        });
        
        // Generate Insights
        const keyInsights = [
            `Premium sections (VIP, Court) generate ${formatCurrency(enhancedData.sections[0]['Profit Per Ticket'])} per ticket on average`,
            `Best lead time: 90+ days ahead yields ${formatCurrency(enhancedData.lead_time[4]['Avg Profit'])} avg profit`,
            `Tuesday is the most profitable day with ${formatCurrency(enhancedData.day_of_week[1]['Total Profit'])} total profit`,
            `${summary.avg_markup_pct.toFixed(1)}% average markup across all transactions`
        ];
        
        const opportunities = [
            `Focus on 7-ticket orders - they yield ${formatCurrency(enhancedData.quantity_optimization[1]['Avg Profit'])} avg profit`,
            `Premium sections show 10x higher profit per ticket than average`,
            `Early booking (90+ days) generates 4.5x higher profits than same-day sales`,
            `"Other" category dominates with ${(enhancedData.categories[0].Profit/summary.total_losses*100).toFixed(0)}% of profit - investigate subcategories`
        ];
        
        const riskAreas = [
            `${formatCurrency(Math.abs(summary.total_losses))} in total losses from ${formatNumber(summary.loss_count)} transactions`,
            `PRDRESALE tag shows negative profit - review pricing strategy`,
            `${enhancedData.loss_venues.length} venues consistently show losses`,
            `Same-day sales have lowest profit margins - implement dynamic pricing`
        ];
        
        const lossMitigation = [
            `<strong>Venue Strategy:</strong> Review pricing and cost structure for ${enhancedData.loss_venues[0].Venue} and other loss-making venues`,
            `<strong>Event Selection:</strong> Consider avoiding or adjusting pricing for consistently unprofitable events`,
            `<strong>Tag Management:</strong> PRDRESALE tag shows ${formatCurrency(enhancedData.tags.find(t => t.Tags === 'PRDRESALE')?.Profit || 0)} loss - investigate resale pricing`,
            `<strong>Lead Time Optimization:</strong> Implement early-bird discounts to encourage 90+ day advance purchases`,
            `<strong>Dynamic Pricing:</strong> Same-day sales show lowest margins - implement surge pricing for last-minute buyers`
        ];
        
        document.getElementById('keyInsights').innerHTML = keyInsights.map(i => 
            `<div class="insight-item">${i}</div>`
        ).join('');
        
        document.getElementById('opportunities').innerHTML = opportunities.map(o => 
            `<div class="insight-item">${o}</div>`
        ).join('');
        
        document.getElementById('riskAreas').innerHTML = riskAreas.map(r => 
            `<div class="insight-item">${r}</div>`
        ).join('');
        
        document.getElementById('lossMitigation').innerHTML = lossMitigation.map(m => 
            `<div class="insight-item">${m}</div>`
        ).join('');
        
        // Price Bucket Insights
        const priceBucketInsights = [];
        
        // Find best margin bucket
        const bestMarginBucket = enhancedData.price_buckets.reduce((max, p) => 
            p['Profit Margin %'] > max['Profit Margin %'] ? p : max
        );
        priceBucketInsights.push(
            `<strong>Best Margin:</strong> ${bestMarginBucket.Bucket} range has the highest profit margin at ${bestMarginBucket['Profit Margin %'].toFixed(2)}% with ${formatCurrency(bestMarginBucket['Total Profit'])} in total profit.`
        );
        
        // Find highest volume bucket
        const highestVolumeBucket = enhancedData.price_buckets.reduce((max, p) => 
            p.Transactions > max.Transactions ? p : max
        );
        priceBucketInsights.push(
            `<strong>Highest Volume:</strong> ${highestVolumeBucket.Bucket} has the most transactions (${formatNumber(highestVolumeBucket.Transactions)}) but only ${highestVolumeBucket['Profit Margin %'].toFixed(2)}% margin.`
        );
        
        // Find highest total profit bucket
        const highestProfitBucket = enhancedData.price_buckets.reduce((max, p) => 
            p['Total Profit'] > max['Total Profit'] ? p : max
        );
        priceBucketInsights.push(
            `<strong>Biggest Profit Driver:</strong> ${highestProfitBucket.Bucket} generates the most total profit at ${formatCurrency(highestProfitBucket['Total Profit'])} (${highestProfitBucket['Profit Margin %'].toFixed(2)}% margin).`
        );
        
        // Best profit per ticket
        const bestPerTicketBucket = enhancedData.price_buckets.reduce((max, p) => 
            p['Avg Profit Per Ticket'] > max['Avg Profit Per Ticket'] ? p : max
        );
        priceBucketInsights.push(
            `<strong>Premium Performance:</strong> ${bestPerTicketBucket.Bucket} tickets yield ${formatCurrency(bestPerTicketBucket['Avg Profit Per Ticket'])} profit per ticket on average.`
        );
        
        // Low margin warning
        const lowMarginBuckets = enhancedData.price_buckets.filter(p => p['Profit Margin %'] < 5);
        if (lowMarginBuckets.length > 0) {
            priceBucketInsights.push(
                `<strong>‚ö†Ô∏è Low Margin Alert:</strong> ${lowMarginBuckets.length} price bucket(s) have margins below 5%. Consider reviewing pricing strategy for ${lowMarginBuckets.map(b => b.Bucket).join(', ')}.`
            );
        }
        
        // Sweet spot recommendation
        const sweetSpots = enhancedData.price_buckets.filter(p => 
            p['Profit Margin %'] > 11 && p.Transactions > 500
        );
        if (sweetSpots.length > 0) {
            priceBucketInsights.push(
                `<strong>üí∞ Sweet Spots:</strong> ${sweetSpots.length} price range(s) combine high margins (>11%) with strong volume (>500 transactions): ${sweetSpots.map(b => b.Bucket).join(', ')}.`
            );
        }
        
        document.getElementById('priceBucketInsights').innerHTML = priceBucketInsights.map(i => 
            `<div class="insight-item">${i}</div>`
        ).join('');
    </script>
</body>
</html>